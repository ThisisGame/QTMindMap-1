<html>
	<head>
	<link href="../../third-party/google-code-prettify\prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	<script type="text/javascript" src="../../third-party/google-code-prettify\prettify.js"></script>
	</head>
	<title>
		composite.cpp
	</title>
	<body onload="prettyPrint()">
		<pre class="prettyprint lang-cpp linenums">#include "Composite.h"
#include "GraphicComponentItem.h"
#include "MindMapGUIScene.h"

Composite::Composite(int id)
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    _id = id;</span>
<span style = "background-color:#dfd">    _parent = NULL;</span>
<span style = "background-color:#dfd">    _side = NONE_SIDE;</span>
<span style = "background-color:#dfd">    _expend = true;</span>
<span style = "background-color:#dfd">}</span>

Composite::~Composite()
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    for (auto child : _nodelist)</span>
    {
<span style = "background-color:#dfd">        delete child;</span>
<span style = "background-color:#dfd">    }</span>
<span style = "background-color:#dfd">}</span>

void Composite::addDecorator(Component* decorator)  //¼W¥[
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    if (_parent != NULL)</span>
    {
<span style = "background-color:#fdd">        _parent-&gt;changeNodeByNode(this, decorator);</span>
    }
<span style = "background-color:#fdd">    decorator-&gt;addChild(this);</span>
<span style = "background-color:#fdd">}</span>

void Composite::addChild(Component* node)  //¼W¥[Node
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    node-&gt;setParent(this);</span>
<span style = "background-color:#dfd">    for (auto child : _nodelist)</span>
    {
<span style = "background-color:#dfd">        if (child == node)</span>
        {
<span style = "background-color:#dfd">            return;</span>
<span style = "background-color:#dfd">        }</span>
<span style = "background-color:#dfd">    }</span>
<span style = "background-color:#dfd">    _nodelist.push_back(node);</span>
<span style = "background-color:#dfd">}</span>

void Composite::clearNodeList() //²M°£NodeList¤º©Ò¦³¤¸¯À
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    _nodelist.clear();</span>
<span style = "background-color:#dfd">}</span>

void Composite::addChilds(list&lt;Component*&gt; nodelist)  //¨ú±oNodeList
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    for (auto child : nodelist)</span>
    {
<span style = "background-color:#dfd">        this-&gt;addChild(child);</span>
<span style = "background-color:#dfd">    }</span>
<span style = "background-color:#dfd">}</span>

list&lt;Component*&gt; Composite::getNodeList()  //¨ú±oNodeList
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    return _nodelist;</span>
<span style = "background-color:#dfd">}</span>

void Composite::changeNodeByNode(Component* component, Component* newComponent)
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    for (list&lt;Component*&gt;::iterator i = _nodelist.begin(); i != _nodelist.end(); i++)</span>
    {
<span style = "background-color:#fdd">        if (*i == component)</span>
        {
<span style = "background-color:#fdd">            *i = newComponent;</span>
<span style = "background-color:#fdd">            newComponent-&gt;setParent(this);</span>
<span style = "background-color:#fdd">            return;</span>
<span style = "background-color:#fdd">        }</span>
<span style = "background-color:#fdd">    }</span>
<span style = "background-color:#fdd">}</span>

void Composite::deleteNodeByNode(Component* component)
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    _nodelist.remove(component);</span>
<span style = "background-color:#dfd">}</span>

void Composite::display(stringstream&amp; outputStream, string levelString, bool last) //³B²z¿é¥X¾ðª¬
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    outputStream &lt;&lt; "+-" + _description + "(" + _type + ", ID: " &lt;&lt; _id &lt;&lt; ")" &lt;&lt; endl;  //Output Example +-Computer(Root, ID: 0)</span>
<span style = "background-color:#dfd">    if (last == true)</span>
    {
<span style = "background-color:#dfd">        levelString += "  ";</span>
    }
<span style = "background-color:#dfd">    else</span>
    {
<span style = "background-color:#dfd">        levelString += "| ";</span>
    }
<span style = "background-color:#dfd">    for (list&lt;Component*&gt;::iterator i = _nodelist.begin(); i != _nodelist.end(); i++)</span>
    {
<span style = "background-color:#dfd">        if (i == --_nodelist.end())</span>
        {
<span style = "background-color:#dfd">            last = true;</span>
        }
<span style = "background-color:#dfd">        else</span>
        {
<span style = "background-color:#dfd">            last = false;</span>
        }
<span style = "background-color:#dfd">        outputStream &lt;&lt; levelString;</span>
<span style = "background-color:#dfd">        (*i)-&gt;display(outputStream, levelString, last);</span>
<span style = "background-color:#dfd">    }</span>
<span style = "background-color:#dfd">}</span>

void Composite::calculatePos(int&amp; position, int level, MindMapGUIScene* scene, string side)  	//AutoLayout­pºâ°Ï¶ô
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    int NODE_DIST = 25;</span>
<span style = "background-color:#fdd">    int x = level;</span>
<span style = "background-color:#fdd">    int y = position;</span>
<span style = "background-color:#fdd">    scene-&gt;createItem(_id, _description);</span>
<span style = "background-color:#fdd">    setHeightAndWidth(scene-&gt;getHeight(), scene-&gt;getWidth());</span>
<span style = "background-color:#fdd">    level = level + scene-&gt;getWidth() + NODE_DIST;</span>
<span style = "background-color:#fdd">    scene-&gt;deleteItem();</span>
<span style = "background-color:#fdd">    if (_expend == true)</span>
    {
<span style = "background-color:#fdd">        for (auto child : _nodelist)</span>
        {
<span style = "background-color:#fdd">            child-&gt;calculatePos(position, level, scene, side);</span>
<span style = "background-color:#fdd">        }</span>
    }
<span style = "background-color:#fdd">    int height = position - y;</span>
<span style = "background-color:#fdd">    if (height != 0)</span>
    {
<span style = "background-color:#fdd">        y = y + (height - NODE_DIST - _height) / 2;</span>
    }
<span style = "background-color:#fdd">    else</span>
    {
<span style = "background-color:#fdd">        position += _height + NODE_DIST;</span>
    }
<span style = "background-color:#fdd">    _side = side;</span>
<span style = "background-color:#fdd">    if (_side == RIGHT_SIDE)</span>
    {
<span style = "background-color:#fdd">        setPoint(x, y);</span>
    }
<span style = "background-color:#fdd">    else</span>
    {
<span style = "background-color:#fdd">        setPoint(-x, y);</span>
    }
<span style = "background-color:#fdd">    if (height != 0 &amp;&amp; height &lt; _height)</span>
    {
<span style = "background-color:#fdd">        int changeHeightAmount = _height - height;</span>
<span style = "background-color:#fdd">        setChildrenYPoint(changeHeightAmount / 2);</span>
<span style = "background-color:#fdd">        position += changeHeightAmount;</span>
    }
<span style = "background-color:#fdd">}</span>

void Composite::setChildrenYPoint(int height)
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    _point[1] += height;</span>
<span style = "background-color:#fdd">    for (auto child : _nodelist)</span>
    {
<span style = "background-color:#fdd">        child-&gt;setChildrenYPoint(height);</span>
<span style = "background-color:#fdd">    }</span>
<span style = "background-color:#fdd">}</span>

void Composite::setChildrenXPoint(int x, bool firstNode)
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    if (firstNode == false)</span>
    {
<span style = "background-color:#fdd">        _point[0] += x;</span>
    }
<span style = "background-color:#fdd">    firstNode = false;</span>
<span style = "background-color:#fdd">    for (auto child : _nodelist)</span>
    {
<span style = "background-color:#fdd">        child-&gt;setChildrenXPoint(x, firstNode);</span>
<span style = "background-color:#fdd">    }</span>
<span style = "background-color:#fdd">}</span>

Component* Composite::getDecorator()
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    if (_parent != NULL &amp;&amp; _parent-&gt;isDecorator())</span>
    {
<span style = "background-color:#fdd">        return _parent-&gt;getDecorator();</span>
    }
<span style = "background-color:#fdd">    else</span>
    {
<span style = "background-color:#dfd">        return this;</span>
    }
<span style = "background-color:#dfd">}</span>

bool Composite::isDecorator()
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    return false;</span>
<span style = "background-color:#dfd">}</span>

string Composite::getSide()
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    return _side;</span>
<span style = "background-color:#fdd">}</span>

bool Composite::isExpend()
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    return _expend;</span>
<span style = "background-color:#fdd">}</span>

void Composite::setExpend(bool expend)
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    _expend = expend;</span>
<span style = "background-color:#fdd">}</span>

void Composite::up(Component* component)
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    if (*_nodelist.begin() == component)</span>
    {
<span style = "background-color:#fdd">        return;</span>
    }
<span style = "background-color:#fdd">    list&lt;Component*&gt;::iterator upComponent;</span>
<span style = "background-color:#fdd">    for (list&lt;Component*&gt;::iterator i = _nodelist.begin(); i != _nodelist.end(); i++)</span>
    {
<span style = "background-color:#fdd">        if (*i == component)</span>
        {
<span style = "background-color:#fdd">            Component*  newComponent = *upComponent;</span>
<span style = "background-color:#fdd">            *upComponent = component;</span>
<span style = "background-color:#fdd">            *i = newComponent;</span>
<span style = "background-color:#fdd">            return;</span>
        }
<span style = "background-color:#fdd">        upComponent = i;</span>
<span style = "background-color:#fdd">    }</span>
<span style = "background-color:#fdd">}</span>

void Composite::down(Component* component)
<span style = "background-color:#fdd">{</span>
<span style = "background-color:#fdd">    if (*--_nodelist.end() == component)</span>
    {
<span style = "background-color:#fdd">        return;</span>
    }
<span style = "background-color:#fdd">    list&lt;Component*&gt;::iterator upComponent;</span>
<span style = "background-color:#fdd">    for (list&lt;Component*&gt;::iterator i = _nodelist.begin(); i != _nodelist.end(); i++)</span>
    {
<span style = "background-color:#fdd">        if (*i == component)</span>
        {
<span style = "background-color:#fdd">            upComponent = i++;</span>
<span style = "background-color:#fdd">            Component* newComponent = *i;</span>
<span style = "background-color:#fdd">            *upComponent = newComponent;</span>
<span style = "background-color:#fdd">            *i = component;</span>
<span style = "background-color:#fdd">            return;</span>
<span style = "background-color:#fdd">        }</span>
<span style = "background-color:#fdd">    }</span>
<span style = "background-color:#fdd">}</span>

bool Composite::isUpComonent(Component* component)
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    if (*_nodelist.begin() == component)</span>
    {
<span style = "background-color:#dfd">        return true;</span>
    }
<span style = "background-color:#dfd">    return false;</span>
<span style = "background-color:#dfd">}</span>

bool Composite::isUnderComonent(Component* component)
<span style = "background-color:#dfd">{</span>
<span style = "background-color:#dfd">    if (*--_nodelist.end() == component)</span>
    {
<span style = "background-color:#dfd">        return true;</span>
    }
<span style = "background-color:#dfd">    return false;</span>
<span style = "background-color:#dfd">}</span>
</pre>
	</body>
</html>